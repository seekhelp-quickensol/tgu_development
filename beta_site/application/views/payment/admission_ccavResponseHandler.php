<?php$university_details = $this->Setting_model->get_university_details();include('Authentication.php');$query = $_REQUEST['encResponse']; $authKey = AUTH_KEY;$authIV = AUTH_IV; $decText = null;$AesCipher = new AesCipher();$decText = $AesCipher->decrypt($authKey, $authIV, $query); $token = strtok($decText, "&");   $rcvdString = $AesCipher->decrypt($authKey, $authIV, $query); $order_status = "";$order_id = "";$tracking_id = "";$bank_ref_no = "";$amount = "0";$payment_by = "";$decryptValues = explode('&', $rcvdString);$dataSize = sizeof($decryptValues);for ($i = 0; $i < $dataSize; $i++) {	$information = explode('=', $decryptValues[$i]);	if ($i == 11)	$order_status = $information[1];	if ($i == 4)	$ex_order_id = $information[1];	if ($i == 14)	$tracking_id = $information[1];	if ($i == 5)	$amount = $information[1];	if ($i == 8)	$payment_by = $information[1];}$order_id = explode("___", $ex_order_id);$order_id = $order_id[1];$data = array(	'transaction_id' => $tracking_id,);$this->db->where('id', $order_id);$this->db->update('tbl_student_fees', $data);$this->db->where('transaction_id', $tracking_id);$this->db->where('id !=', $order_id);$exist = $this->db->get('tbl_student_fees');$exist = $exist->row();if (!empty($exist)) {	//echo "exist";	$order_status = "Failure";}//echo $this->session->userdata('session_amount')."a"		/*if($this->session->userdata('session_amount') != $amount){	   // echo "amount";		$order_status = "Failure";	};	if($this->session->userdata('order_id') != $order_id){	    //echo "order";		$order_status = "Failure";	}*/$this->db->where('id', $order_id);$real_fees = $this->db->get('tbl_student_fees');$real_fees = $real_fees->row();//&& $real_fees->total_fees == $amountif ($order_status === "SUCCESS" && $real_fees->total_fees == $amount) {	$data = array(		'transaction_id' 	=> $tracking_id,		'payment_status' 	=> '1',	);	$this->db->where('id', $order_id);	$this->db->update('tbl_student_fees', $data);	$this->db->where('id', $order_id);	$fees_data = $this->db->get('tbl_student_fees');	$fees_data = $fees_data->row();		$this->db->where('id', $fees_data->student_id);	$student_details = $this->db->get("tbl_student");	$student_details = $student_details->row();	$this->db->where('id', $student_details->faculty_id);	$faculty = $this->db->get('tbl_faculty');	$faculty = $faculty->row();	$this->db->where('faculty', $student_details->faculty_id);	$this->db->where('course', $student_details->course_id);	$this->db->where('stream', $student_details->stream_id);	$this->db->where('is_deleted', '0');	$this->db->where('status', '1');	$course_code = $this->db->get('tbl_course_stream_relation');	$course_code = $course_code->row();		$this->db->where('id', $student_details->center_id);	$center_details = $this->db->get("tbl_center");	$center_details = $center_details->row();	$this->db->where('id', $student_details->session_id);	$session_year = $this->db->get('tbl_session');	$session_year = $session_year->row();		$session_date = $lastTwoDigits1 = substr($session_year->session_name, -2);		$enrollment = "";	$enrollment .= $session_date;	if (!empty($center_details)) {		//$enrollment .= $center_details->center_code;	}	if (!empty($course_code)) {		$enrollment .= $course_code->course_code;	} 		if(!empty($faculty)){ 		//$enrollment .= $faculty->faculty_code; 	}  	$last_digit = 10000;	if(strlen($student_details->id) == "1"){			$last_digit = 10000;	}	if(strlen($student_details->id) == "2"){			$last_digit = 1000;	}	if(strlen($student_details->id) == "3"){			$last_digit = 100;	}	if(strlen($student_details->id) == "4"){			$last_digit = 10;	}	if(strlen($student_details->id) == "5"){			$last_digit = 1;	}	if(strlen($student_details->id) == "6"){			$last_digit = "";	}	$enrollment .=$last_digit.$student_details->id;		 	$enorlled_data = array(		'admission_status' 	=> '1',		'enrollment_number' => $enrollment,		'enrollment_date' 	=> date("Y-m-d"),	);	$this->db->where('id', $student_details->id);	$this->db->update("tbl_student", $enorlled_data);	//echo "<br>Thank you for shopping with us. Your credit card has been charged and your transaction is successful. We will be shipping your order to you soon.";} else if ($order_status === "Aborted") {	//echo "<br>Thank you for shopping with us.We will keep you posted regarding the status of your order through e-mail";} else if ($order_status === "Failure") {	//echo "<br>Thank you for shopping with us.However,the transaction has been declined.";} else {	//echo "<br>Security Error. Illegal access detected";}//echo "<br><br>";/*echo "<table cellspacing=4 cellpadding=4>";	for($i = 0; $i < $dataSize; $i++) 	{		$information=explode('=',$decryptValues[$i]);	    	echo '<tr><td>'.$i.'-'.$information[0].'</td><td>'.urldecode($information[1]).'</td></tr>';	}	echo "</table><br>";	echo "</center>";	*/ $this->db->select('tbl_student_fees.*,tbl_course.print_name,tbl_stream.stream_name,tbl_student.center_id,tbl_student.enrollment_number,tbl_student.email, tbl_student.student_name, tbl_student.mobile, tbl_student.address, tbl_student.pincode, countries.name as country_name, states.name as state_name, cities.name as city_name'); $this->db->where('tbl_student_fees.id', $order_id);$this->db->join('tbl_student','tbl_student.id = tbl_student_fees.student_id');$this->db->join('tbl_course','tbl_course.id = tbl_student.course_id');$this->db->join('tbl_stream','tbl_stream.id = tbl_student.stream_id');$this->db->join('countries','countries.id = tbl_student.country','left');$this->db->join('states','states.id = tbl_student.state','left');$this->db->join('cities','cities.id = tbl_student.city','left'); $result = $this->db->get('tbl_student_fees');$result = $result->row();  $receipt_no = "";	if(strlen($result->id) == "1"){	    $receipt_no = "ADM-000".$result->id;    	}else if(strlen($result->id) == "2"){	    $receipt_no = "ADM-00".$result->id;     	}else if(strlen($result->id) == "3"){	    $receipt_no = "ADM-0".$result->id;     	}else{	    $receipt_no = "ADM-".$result->id;	}	$date_of_receipt = date("d/m/Y",strtotime($result->created_on));	$enrollment_number = $result->student_id;	$student_name = $result->student_name;	$print_name = $result->print_name;	$stream_name = $result->stream_name;	$address = $result->address.', '.$result->city_name.', '.$result->state_name.', '.$result->country_name.'-'.$result->pincode;	$mobile = $result->mobile;	$email = $result->email;	$ref_level = "Registration No";	$pay_for="Admission Fees";	$transaction_id = $result->transaction_id;	$print_amount = $result->total_fees;	include('final_receipt.php');?> 