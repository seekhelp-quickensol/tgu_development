<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed'); class Center_api_model extends CI_Model { 	public function get_center_login(){  		//print_r();exit();		$_GET = $_POST;		$this->db->where('is_deleted','0');		$this->db->where('status','1');		$this->db->where('username',$this->input->post('username'));		$this->db->where('password',$this->input->post('password'));		$result = $this->db->get('tbl_center_login');		$result = $result->row(); 		echo json_encode($result);	}    public function get_center_profile(){  		$_GET = $_POST;		$this->db->where('is_deleted','0');		$this->db->where('status','1');		$this->db->where('center_id',$this->input->post('center_id')); 		$result = $this->db->get('tbl_center_login');		$result = $result->row();		echo json_encode($result);	}     public function get_center_students(){  		$_GET = $_POST;		$new_arr = array();		$this->db->select('tbl_student.*,tbl_course.course_name,tbl_session.session_name,tbl_stream.stream_name');		$this->db->join('tbl_course','tbl_course.id = tbl_student.course_id');		$this->db->join('tbl_stream','tbl_stream.id = tbl_student.stream_id');		$this->db->join('tbl_session','tbl_session.id = tbl_student.session_id');		$this->db->where('tbl_student.is_deleted','0');		$this->db->where('tbl_student.status','1');		$this->db->where('tbl_student.admission_status','1');		$this->db->where('tbl_student.center_id',$this->input->post("center_id")); 		$result = $this->db->get('tbl_student');		$result = $result->result();		if(!empty($result)){			$i=0;			foreach($result as $arr_result){				$payable_fees = $this->get_center_students_payable_fees($arr_result->id); 				$paid_amt = $this->get_student_paid_addmission_fees($arr_result->id); 				$total_paid_amt = 0;				if(!empty($paid_amt)){					foreach($paid_amt as $paid_amt_result){						$total_paid_amt = $total_paid_amt + $paid_amt_result->amount;					}				}     				$arr_result->payable_fees = $payable_fees;				$arr_result->paid_amt = $total_paid_amt;				$new_arr[] = $arr_result;				$i++;			} 		}		//echo "<pre>";print_r($arr_result);exit;		echo json_encode($new_arr);	}	public function get_center_students_payable_fees($student_id){		$_GET = $_POST;  		$student_fees = 0;		$course_fees = 0;		$final_student_fees = 0;				$this->db->where('id',$student_id);		$result = $this->db->get('tbl_student');		$result = $result->row();		 		if(!empty($result)){			$this->db->where('is_deleted','0');			$this->db->where('status','1');			$this->db->where('course',$result->course_id);			$this->db->where('stream',$result->stream_id);			$relation = $this->db->get('tbl_course_stream_relation');			$relation = $relation->row();			if(!empty($relation)){				$this->db->where('session_id',$result->session_id);				$this->db->where('relation_id',$relation->id);				$this->db->where('course_id',$result->course_id);				$this->db->where('stream_id',$result->stream_id);				$course_fee = $this->db->get('tbl_fees_realtion');				$course_fee = $course_fee->row();				if(!empty($course_fee)){				    if($result->center_id == "1"){					    $course_fees =  $course_fee->campus_fees;				    }else{				        $course_fees =  $course_fee->fees;				    }				}else{					$this->db->where('relation_id',$relation->id);					$this->db->where('course_id',$result->course_id);					$this->db->where('stream_id',$result->stream_id);					$this->db->order_by('id','DESC');					$course_fee = $this->db->get('tbl_fees_realtion');					$course_fee = $course_fee->row();					if(!empty($course_fee)){						if($result->center_id == "1"){    					    $course_fees =  $course_fee->campus_fees;    				    }else{    				        $course_fees =  $course_fee->fees;    				    }					}				}			}			if($result->country != "101"){				$course_fees = $course_fees*2;			}			//echo $course_fees;exit;			$course_yearly_fees = $course_fees;			$course_halfyearly_fees = $course_fees/2;						if($result->admission_type == '0'){				if($result->course_mode == '1'){					$student_fees = $course_yearly_fees*$result->year_sem;				}else if($result->course_mode == '2'){										$student_fees = $course_yearly_fees*$result->year_sem;				}			}else{				if($result->course_mode == '1'){					$lateral_diffrent = $result->year_sem - $result->lateral_year;					$lateral_diffrent = $lateral_diffrent+1;					$student_fees = $course_yearly_fees*$lateral_diffrent;				}else if($result->course_mode == '2'){					$lateral_diffrent = $result->year_sem - $result->lateral_year;					$lateral_diffrent = $lateral_diffrent+1;					$student_fees = $course_yearly_fees*$lateral_diffrent;				}			}			if($result->center_id == '1'){				$final_student_fees = $student_fees;			}else if($result->center_id != '1'){				$this->db->where('id',$result->center_id);				$result = $this->db->get('tbl_center');				$result = $result->row();				if(!empty($result)){					if($result->fee_share != ""){						$center_share = $result->fee_share;					}else{						$center_share = 0;					}				}else{					$center_share = 0;				}								if($center_share != "0"){					$final_student_fees = ($center_share/100)*$student_fees;				}else{					$final_student_fees = $student_fees;				}				//$final_student_fees = $student_fees;			}			//echo $final_student_fees;exit;		}		return $final_student_fees;		}	public function get_student_paid_addmission_fees($student_id){		$_GET = $_POST;		$this->db->where('status','1'); 		$this->db->where('payment_status','1'); 		$this->db->where('fees_type','1');  		$this->db->where('student_id',$student_id);		$this->db->order_by('id','DESC');		$result = $this->db->get('tbl_student_fees');		$result = $result->result();		return $result;	}	public function set_alumni_center_password_update(){		$_GET = $_POST;		$data = array(			'password' => $this->input->post('new_password'),		);		$this->db->where('center_id',$this->input->post('center_id'));  		$this->db->update('tbl_center_login',$data);		return true;	}	public function get_center_ledger(){		$_GET = $_POST;		$this->db->select('tbl_center_student_separate_ledger.*,tbl_student.student_name,tbl_course.course_name,tbl_stream.stream_name,tbl_session.session_name,');		$this->db->where('tbl_center_student_separate_ledger.center_id',$this->input->post('center_id'));		$this->db->where('tbl_center_student_separate_ledger.is_deleted','0');		$this->db->join('tbl_student','tbl_student.enrollment_number = tbl_center_student_separate_ledger.enrollment_number');		$this->db->join('tbl_course','tbl_course.id = tbl_student.course_id');		$this->db->join('tbl_stream','tbl_stream.id = tbl_student.stream_id');		$this->db->join('tbl_session','tbl_session.id = tbl_student.session_id');		$this->db->group_by('tbl_center_student_separate_ledger.enrollment_number');		$result = $this->db->get('tbl_center_student_separate_ledger');		echo json_encode($result->result());	}	public function get_center_ledger_all(){		$_GET = $_POST;		$this->db->where('tbl_center_student_separate_ledger.center_id',$this->input->post('center_id'));		$this->db->where('tbl_center_student_separate_ledger.is_deleted','0');		$this->db->order_by('installment','ASC');		$result = $this->db->get('tbl_center_student_separate_ledger');		echo json_encode($result->result());	}	public function get_center_submit_amount(){		$_GET = $_POST;		$this->db->where('center_id',$this->input->post('center_id'));		$this->db->where('is_deleted','0');		$this->db->order_by('id','DESC');		$result = $this->db->get('tbl_center_private_received_amount');		echo json_encode($result->result());	} 	}