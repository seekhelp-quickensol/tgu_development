<?php if (! defined('BASEPATH')) exit('No direct script access allowed');class Research_controller extends CI_Controller{	public function __construct()	{		parent::__construct();		$this->is_logged();		//$this->check_access();	}	public function is_logged()	{		if ($this->session->userdata('admin_id') == "") {			redirect('erp-access');		}	}	public function check_access()	{		if ($this->session->userdata('admin_id') != "1") {			$access = $this->Setting_model->get_user_privilege_link();			if (!in_array($this->uri->segment(1), $access)) {				$this->session->set_flashdata('message', 'Sorry! You dont have access to this module!');				redirect(base_url());			}		}	}	public function progress_report_list_research()	{		$this->load->view('admin/progress_report_list_research');	}	public function guide_application_list()	{		$this->load->view('admin/guide_application_list');	}	public function guide_documents()	{		$data['qualification'] = $this->Research_model->get_single_guide();		$this->load->view('admin/guide_documents', $data);	}	public function print_phd_registration_form()	{		$data['single'] = $this->Research_model->get_phd_single_student();		$this->load->view('admin/print_phd_registration_form', $data);	}	public function guide_application_update()	{		$this->form_validation->set_rules('name', 'Name', 'required');		if ($this->form_validation->run() === FALSE) {			$data['single_guide_applications'] = $this->Research_model->get_all_guide_application();			// echo "<pre>";print_r($data['single_guide_applications']);exit;			$data['country'] = $this->Web_model->get_all_country();			$data['signature'] = $this->Setting_model->get_all_signature();			$this->load->view('admin/guide_application_update', $data);		} else {			$photo = '';			if ($_FILES['photo']['name'] != "") {				$photo = $this->Digitalocean_model->upload_photo($filename = "photo", $path = "images/guide_pic/");				/*$tmp = explode('.', $_FILES['photo']['name']);				$ext = end($tmp);				$config = array(					'upload_path' 	=> "images/guide_pic",					'allowed_types' => "jpg|jpeg|png",					'encrypt_name' => TRUE,				);							$this->upload->initialize($config);				if($this->upload->do_upload('photo')){					$data = $this->upload->data();									$photo = $data['file_name'];					}else{ 					$error = array('error' => $this->upload->display_errors());						$this->upload->display_errors();				}*/			} else {				$photo = $this->input->post('old_photo');			}			$signature = '';			if ($_FILES['signature']['name'] != "") {				$signature = $this->Digitalocean_model->upload_photo($filename = "signature", $path = "images/guide_pic/");				/*$tmp = explode('.', $_FILES['signature']['name']);				$ext = end($tmp);				$config = array(					'upload_path' 	=> "images/guide_pic",					'allowed_types' => "jpg|jpeg|png",					'encrypt_name' => TRUE,				);							$this->upload->initialize($config);				if($this->upload->do_upload('signature')){					$data = $this->upload->data();									$signature = $data['file_name'];					}else{ 					$error = array('error' => $this->upload->display_errors());						$this->upload->display_errors();				}*/			} else {				$signature = $this->input->post('old_signature');			}			$secondary_subject_marksheet = '';			if ($_FILES['secondary_subject_marksheet']['name'] != "") {				$secondary_subject_marksheet = $this->Digitalocean_model->upload_photo($filename = "secondary_subject_marksheet", $path = "images/guide_pic/guide_document/");				/*$tmp = explode('.', $_FILES['secondary_subject_marksheet']['name']);				$ext = end($tmp);				$config = array(					'upload_path' 	=> "images/guide_pic/guide_document",					'allowed_types' => "jpg|jpeg|png|pdf",					'encrypt_name' => TRUE,				);							$this->upload->initialize($config);				if($this->upload->do_upload('secondary_subject_marksheet')){					$data = $this->upload->data();									$secondary_subject_marksheet = $data['file_name'];					}else{ 					$error = array('error' => $this->upload->display_errors());						$this->upload->display_errors();				}*/			} else {				$secondary_subject_marksheet = $this->input->post('old_secondary_subject_marksheet');			}			$sr_secondary_subject_marksheet = '';			if ($_FILES['sr_secondary_subject_marksheet']['name'] != "") {				$sr_secondary_subject_marksheet = $this->Digitalocean_model->upload_photo($filename = "sr_secondary_subject_marksheet", $path = "images/guide_pic/guide_document/");				/*$tmp = explode('.', $_FILES['sr_secondary_subject_marksheet']['name']);				$ext = end($tmp);				$config = array(					'upload_path' 	=> "images/guide_pic/guide_document",					'allowed_types' => "jpg|jpeg|png|pdf",					'encrypt_name' => TRUE,				);							$this->upload->initialize($config);				if($this->upload->do_upload('sr_secondary_subject_marksheet')){					$data = $this->upload->data();									$sr_secondary_subject_marksheet = $data['file_name'];					}else{ 					$error = array('error' => $this->upload->display_errors());						$this->upload->display_errors();				}*/			} else {				$sr_secondary_subject_marksheet = $this->input->post('old_sr_secondary_subject_marksheet');			}			$graduation_subject_marksheet = '';			if ($_FILES['graduation_subject_marksheet']['name'] != "") {				$graduation_subject_marksheet = $this->Digitalocean_model->upload_photo($filename = "graduation_subject_marksheet", $path = "images/guide_pic/guide_document/");				/*$tmp = explode('.', $_FILES['graduation_subject_marksheet']['name']);				$ext = end($tmp);				$config = array(					'upload_path' 	=> "images/guide_pic/guide_document",					'allowed_types' => "jpg|jpeg|png|pdf",					'encrypt_name' => TRUE,				);							$this->upload->initialize($config);				if($this->upload->do_upload('graduation_subject_marksheet')){					$data = $this->upload->data();									$graduation_subject_marksheet = $data['file_name'];					}else{ 					$error = array('error' => $this->upload->display_errors());						$this->upload->display_errors();				}*/			} else {				$graduation_subject_marksheet = $this->input->post('old_graduation_subject_marksheet');			}			$post_graduation_subject_marksheet = '';			if ($_FILES['post_graduation_subject_marksheet']['name'] != "") {				$post_graduation_subject_marksheet = $this->Digitalocean_model->upload_photo($filename = "post_graduation_subject_marksheet", $path = "images/guide_pic/guide_document/");				/*$tmp = explode('.', $_FILES['post_graduation_subject_marksheet']['name']);				$ext = end($tmp);				$config = array(					'upload_path' 	=> "images/guide_pic/guide_document",					'allowed_types' => "jpg|jpeg|png|pdf",					'encrypt_name' => TRUE,				);							$this->upload->initialize($config);				if($this->upload->do_upload('post_graduation_subject_marksheet')){					$data = $this->upload->data();									$post_graduation_subject_marksheet = $data['file_name'];					}else{ 					$error = array('error' => $this->upload->display_errors());						$this->upload->display_errors();				}*/			} else {				$post_graduation_subject_marksheet = $this->input->post('old_post_graduation_subject_marksheet');			}			$phd_subject_marksheet = '';			if ($_FILES['phd_subject_marksheet']['name'] != "") {				$phd_subject_marksheet = $this->Digitalocean_model->upload_photo($filename = "phd_subject_marksheet", $path = "images/guide_pic/guide_document/");				/*				$tmp = explode('.', $_FILES['phd_subject_marksheet']['name']);				$ext = end($tmp);				$config = array(					'upload_path' 	=> "images/guide_pic/guide_document",					'allowed_types' => "jpg|jpeg|png|pdf",					'encrypt_name' => TRUE,				);							$this->upload->initialize($config);				if($this->upload->do_upload('phd_subject_marksheet')){					$data = $this->upload->data();									$phd_subject_marksheet = $data['file_name'];					}else{ 					$error = array('error' => $this->upload->display_errors());						$this->upload->display_errors();				}*/			} else {				$phd_subject_marksheet = $this->input->post('old_phd_subject_marksheet');			}			$other_qualification_subject_marksheet = '';			if ($_FILES['other_qualification_subject_marksheet']['name'] != "") {				$other_qualification_subject_marksheet = $this->Digitalocean_model->upload_photo($filename = "other_qualification_subject_marksheet", $path = "images/guide_pic/guide_document/");				/*				$tmp = explode('.', $_FILES['other_qualification_subject_marksheet']['name']);				$ext = end($tmp);				$config = array(					'upload_path' 	=> "images/guide_pic/guide_document",					'allowed_types' => "jpg|jpeg|png|pdf",					'encrypt_name' => TRUE,				);							$this->upload->initialize($config);				if($this->upload->do_upload('other_qualification_subject_marksheet')){					$data = $this->upload->data();									$other_qualification_subject_marksheet = $data['file_name'];					}else{ 					$error = array('error' => $this->upload->display_errors());						$this->upload->display_errors();				}*/			} else {				$other_qualification_subject_marksheet = $this->input->post('old_other_qualification_subject_marksheet');			}			$biodata = '';			if ($_FILES['biodata']['name'] != "") {				$biodata = $this->Digitalocean_model->upload_photo($filename = "biodata", $path = "images/guide_pic/guide_document/");				/*				$tmp = explode('.', $_FILES['biodata']['name']);				$ext = end($tmp);				$config = array(					'upload_path' 	=> "images/guide_pic/guide_document",					'allowed_types' => "*",					'encrypt_name' => TRUE,				);							$this->upload->initialize($config);				if($this->upload->do_upload('biodata')){					$data = $this->upload->data();									$biodata = $data['file_name'];					}else{ 					$error = array('error' => $this->upload->display_errors());						$this->upload->display_errors();				}*/			} else {				$biodata = $this->input->post('old_biodata');			}			$aadhar_card = '';			if ($_FILES['aadhar_card']['name'] != "") {				$aadhar_card = $this->Digitalocean_model->upload_photo($filename = "aadhar_card", $path = "images/guide_pic/guide_document/");				/*$tmp = explode('.', $_FILES['aadhar_card']['name']);				$ext = end($tmp);				$config = array(					'upload_path' 	=> "images/guide_pic/guide_document",					'allowed_types' => "*",					'encrypt_name' => TRUE,				);							$this->upload->initialize($config);				if($this->upload->do_upload('aadhar_card')){					$data = $this->upload->data();									$aadhar_card = $data['file_name'];					}*/			} else {				$aadhar_card = $this->input->post('old_aadhar_card');			}			$this->Research_model->update_guide_application($photo, $signature, $secondary_subject_marksheet, $sr_secondary_subject_marksheet, $graduation_subject_marksheet, $post_graduation_subject_marksheet, $phd_subject_marksheet, $other_qualification_subject_marksheet, $biodata, $aadhar_card);			$this->session->set_flashdata('success', 'Guide Application Updated Successfully');			redirect('guide_application_list');		}	}	public function phd_course_work_schedule()	{		$this->form_validation->set_rules("schedule_date", "date", "required");		if ($this->form_validation->run() == false) {			$data["all_data"] = $this->Research_model->get_phd_course_work_schedule_for_admin_dispaly();			if (!empty($this->uri->segment(2))) {				$data["edit_data"] = $this->Research_model->edit_phd_course_work_schedule();			}			$this->load->view("admin/phd_course_work_schedule", $data);		} else {			$res = $this->Research_model->set_phd_course_work_schedule();			if ($res == "saved") {				$this->session->set_flashdata("success", "schedule date added");			} else {				$this->session->set_flashdata("success", "schedule date updated");			}			redirect("phd_course_work_schedule");		}	}	public function phd_course_work_data()	{		$this->load->view("admin/phd_course_work_data");	}	public function approve_guide_application()	{		$this->Research_model->approve_guide_application();		$this->session->set_flashdata("success", "Guide application approve successfuly.");		// redirect('guide_application_list'); 		redirect('approve_guide_application_list');	}	public function approve_guide_application_list()	{		$this->load->view("admin/approve_guide_application_list");	}	public function guide_payment_details()	{		$data['all_guide_payments'] = $this->Research_model->get_all_guide_payments();		$data['all_guide_payments_blended'] = $this->Research_model->get_all_guide_payments_blended();		$data['all_guide_fees'] = $this->Research_model->get_all_guide_fees();		$data['all_guide_fees_blended'] = $this->Research_model->get_all_guide_fees_blended();		$data['single_guide'] = $this->Research_model->get_single_guide();		// print_r($data['single_guide']);exit();		$this->load->view("admin/guide_payment_details", $data);	}	public function co_guide_payment_details()	{		$data['all_guide_payments'] = $this->Research_model->get_all_co_guide_payments();		$data['all_guide_payments_blended'] = $this->Research_model->get_all_co_guide_payments_blended();		$data['all_guide_fees'] = $this->Research_model->get_all_co_guide_fees();		$data['all_guide_fees_blended'] = $this->Research_model->get_all_co_guide_fees_blended();		$data['single_guide'] = $this->Research_model->get_single_co_guide_data();		// print_r($data['single_guide']);exit();		$this->load->view("admin/co_guide_payment_details", $data);	}	public function view_supervisors_appointment_letter()	{		$data['guide'] = $this->Research_model->get_single_guide_data();		$this->load->view("admin/appointment_letter_for_supervisors", $data);	}	// *************************shubham code *************************	*/	public function phd_course_work_data_success()	{		$this->load->view("admin/phd_course_work_data_success");	}	public function phd_course_work_data_fail()	{		$this->load->view("admin/phd_course_work_data_fail");	}	public function approve_course_work_registration()	{		$this->Research_model->approve_course_work_registration();		$this->session->set_flashdata("success", "Registration application approve successfuly.");		redirect('phd_course_work_data_success');	}	public function phd_course_work_approved_list()	{		$this->load->view("admin/phd_course_work_approved_list");	}	public function disapprove_course_work_registration()	{		$this->Research_model->disapprove_course_work_registration();		$this->session->set_flashdata("success", "Registration application disapprove successfuly.");		redirect('phd_course_work_approved_list');	}	public function course_work_update_payment()	{		$this->form_validation->set_rules("transaction_id", "transaction id", "required");		if ($this->form_validation->run() == false) {			$data["single"] = $this->Research_model->get_single_phd_course_work_payment_detail();			$this->load->view("admin/course_work_update_payment", $data);		} else {			$res = $this->Research_model->update_course_work_update_payment();			if ($res == "saved") {				$this->session->set_flashdata("success", "schedule date added");			} else {				$this->session->set_flashdata("success", "schedule date updated");			}			// redirect("phd_course_work_data_success");			$payment_status = $this->input->post("payment_status");			if ($payment_status == "1") {				redirect("phd_course_work_data_success");			} elseif ($payment_status == "0") {				redirect("phd_course_work_data_fail");			}		}	}	public function assigned_guide_to_scholar()	{		$this->form_validation->set_rules("guide_name", "guide name", "required");		if ($this->form_validation->run() == false) {			$data["guide"] = $this->Research_model->get_approved_guide_application();			$data["student"] = $this->Research_model->get_phd_student();			// echo "<pre>";print_r($data['student']);exit;			$data["single"] = $this->Research_model->get_single_student();			$this->load->view("admin/assigned_guide_to_scholar", $data);		} else {			$res = $this->Research_model->set_assigned_guide_to_scholar();			$this->session->set_flashdata("success", "guide assigned successfully");			redirect("assigned_guide_to_scholar");		}	}	public function guide_payments()	{		$this->form_validation->set_rules('transaction_id', 'Please select transaction id', 'required');		if ($this->form_validation->run() === FALSE) {			$data['student'] = $this->Research_model->get_single_student();			$data['payment'] = $this->Research_model->get_all_guide_payment();			// echo "<pre>";print_r($data['payment']);exit;			$data['single'] = $this->Research_model->get_single_guide_payment();			// echo "<pre>";print_r($data['single']);exit();			$this->load->view("admin/guide_payments", $data);		} else {			if (!empty($_FILES["userfile"]['name']) && $_FILES["userfile"]['name'] != "") {				$fileName = $this->Digitalocean_model->upload_photo($filename = "userfile", $path = "images/guide_payment/");			} else {				$fileName = $this->input->post('old_userfile');			}			$result = $this->Research_model->set_guide_payment($fileName);			if ($result == 0) {				$this->session->set_flashdata('success', 'Payment added successfully!');				// redirect('guide_payments/'.$this->input->post('student_id'));				redirect('assigned_guide_to_scholar');			} else {				$this->session->set_flashdata('success', 'Payment updated successfully!');				// redirect('guide_payments/'.$this->input->post('student_id'));				redirect('assigned_guide_to_scholar');			}		}	}	public function co_guide_payments()	{		$this->form_validation->set_rules('transaction_id', 'Please select transaction id', 'required');		if ($this->form_validation->run() === FALSE) {			$data['student'] = $this->Research_model->get_single_student();			$data['payment'] = $this->Research_model->get_all_co_guide_payment();			$data['single'] = $this->Research_model->get_single_cp_guide_payment();			// print_r($data['payment']);exit();			$this->load->view("admin/co_guide_payments", $data);		} else {			if (!empty($_FILES["userfile"]['name']) && $_FILES["userfile"]['name'] != "") {				$fileName = $this->Digitalocean_model->upload_photo($filename = "userfile", $path = "images/guide_payment/");			} else {				$fileName = $this->input->post('old_userfile');			}			$this->Research_model->set_co_guide_payment($fileName);			if ($result == 0) {				$this->session->set_flashdata('success', 'Payment added successfully!');				// redirect('co_guide_payments/'.$this->input->post('student_id'));				redirect('assigned_guide_to_scholar');			} else {				$this->session->set_flashdata('success', 'Payment updated successfully!');				// redirect('co_guide_payments/'.$this->input->post('student_id'));				redirect('assigned_guide_to_scholar');			}		}	}	public function course_work_update_payment_separate_student()	{		$this->form_validation->set_rules("transaction_id", "transaction id", "required");		if ($this->form_validation->run() == false) {			$data["single"] = $this->Research_model->get_single_phd_course_work_payment_detail_separate_student();			$this->load->view("admin/course_work_update_payment_separate_student", $data);		} else {			$res = $this->Research_model->update_course_work_update_payment_separate_student();			if ($res == "saved") {				$this->session->set_flashdata("success", "Course Work Payment updated Successfully");			} else {				$this->session->set_flashdata("success", "Course Work Payment updated Successfully");			}			if ($this->input->post('payment_status') == '1') {				redirect("phd_course_work_application_success_list");			} else {				redirect("phd_course_work_application_failed_list");			}		}	}	public function approve_course_work_registration_separate_student()	{		$this->Research_model->approve_course_work_registration_separate_student();		$this->session->set_flashdata("success", "Registration application approve successfuly.");		redirect('phd_course_work_application_approved_list');	}	public function disapprove_course_work_registration_seperate_student()	{		$this->Research_model->disapprove_course_work_registration_seperate_student();		$this->session->set_flashdata("success", "Registration application disapprove successfuly.");		redirect('phd_course_work_application_success_list');	}	public function assigned_guide_seperate_student()	{		// $this->load->view("admin/assigned_guide_seperate_student");		$this->form_validation->set_rules("guide_name", "guide name", "required");		if ($this->form_validation->run() == false) {			$data["guide"] = $this->Research_model->get_approved_guide_application();			$data["student"] = $this->Research_model->get_phd_seperate_student();			// print_r($data["student"]);exit();			$data["single"] = $this->Research_model->get_single_seperate_student();			$this->load->view("admin/assigned_guide_seperate_student", $data);		} else {			$res = $this->Research_model->set_assigned_guide_seperate_student();			$this->session->set_flashdata("success", "guide assigned successfully");			redirect("assigned_guide_seperate_student");		}	}	public function guide_payments_blended()	{		$this->form_validation->set_rules('transaction_id', 'Please select transaction id', 'required');		if ($this->form_validation->run() === FALSE) {			$data['student'] = $this->Research_model->get_single_seperate_student();			$data['payment'] = $this->Research_model->get_all_guide_payment_blended();			$data['single'] = $this->Research_model->get_single_guide_payment_blended();			// print_r($data['payment']);exit();			$this->load->view("admin/guide_payments_blended", $data);		} else {			if (!empty($_FILES["userfile"]['name']) && $_FILES["userfile"]['name'] != "") {				$fileName = $this->Digitalocean_model->upload_photo($filename = "userfile", $path = "images/guide_payment/");			} else {				$fileName = $this->input->post('old_userfile');			}			$this->Research_model->set_guide_payment_blended($fileName);			if ($result == 0) {				$this->session->set_flashdata('success', 'Payment added successfully!');				// redirect('guide_payments_blended/'.$this->input->post('student_id'));				redirect('assigned_guide_seperate_student');			} else {				$this->session->set_flashdata('success', 'Payment updated successfully!');				// redirect('guide_payments_blended/'.$this->input->post('student_id'));				redirect('assigned_guide_seperate_student');			}		}	}	public function co_guide_payments_blended()	{		$this->form_validation->set_rules('transaction_id', 'Please select transaction id', 'required');		if ($this->form_validation->run() === FALSE) {			$data['student'] = $this->Research_model->get_single_seperate_student();			$data['payment'] = $this->Research_model->get_all_co_guide_payment_blended();			$data['single'] = $this->Research_model->get_single_cp_guide_payment_blended();			// print_r($data['payment']);exit();			$this->load->view("admin/co_guide_payments_blended", $data);		} else {			if (!empty($_FILES["userfile"]['name']) && $_FILES["userfile"]['name'] != "") {				$fileName = $this->Digitalocean_model->upload_photo($filename = "userfile", $path = "images/guide_payment/");			} else {				$fileName = $this->input->post('old_userfile');			}			$this->Research_model->set_co_guide_payment_blended($fileName);			if ($result == 0) {				$this->session->set_flashdata('success', 'Payment added successfully!');				// redirect('co_guide_payments_blended/'.$this->input->post('student_id'));				redirect('assigned_guide_seperate_student');			} else {				$this->session->set_flashdata('success', 'Payment updated successfully!');				// redirect('co_guide_payments_blended/'.$this->input->post('student_id'));				redirect('assigned_guide_seperate_student');			}		}	}	public function approve_research_cocument()	{		$this->Research_model->approve_research_cocument();		redirect($_SERVER['HTTP_REFERER']);	}	public function set_scholar_details()	{		$this->form_validation->set_rules('scholar_type', 'Scholar Type', 'required');		if ($this->form_validation->run() === FALSE) {			$data['student'] = $this->Research_model->get_scholar_details($this->uri->segment(2));			$data['extra_details'] = $this->Research_model->get_scholar_extra_details($this->uri->segment(2));			// echo '<pre>';print_r($data['single']);exit();			$this->load->view("admin/scholar_details", $data);		} else {			$res = $this->Research_model->set_scholar_details();			if ($res == 1) {				$this->session->set_flashdata('success', 'Scholar details set successfully!');			} else {				$this->session->set_flashdata('message', 'Scholar not found!');			}			redirect('set-scholar-details/' . $this->input->post('student_id'));		}	}	public function add_progress_report()	{		if ($this->input->post('next') == "next") {			$result = $this->Research_model->check_enrollment_number_phd();			if (!empty($result)) {				redirect('add_progress_report/' . $result->id);			} else {				$this->session->set_flashdata('message', 'Please enter valid enrollment number');				redirect('add_progress_report');			}		}		if ($this->input->post('upload') == "upload") {			$progress_report = $this->Digitalocean_model->upload_photo($filename = "userfile", $path = "images/progress_report/");			if ($progress_report == "") {				$this->session->set_flashdata('message', 'File type is not supporting');				redirect($_SERVER['HTTP_REFERER']);			}			if ($this->input->post('report_no') == "1") {				$result = $this->Research_model->upload_progress_report_one($progress_report);			} else if ($this->input->post('report_no') == "2") {				$result = $this->Research_model->upload_progress_report_two($progress_report);			} else if ($this->input->post('report_no') == "3") {				$result = $this->Research_model->upload_progress_report_three($progress_report);			} else if ($this->input->post('report_no') == "4") {				$result = $this->Research_model->upload_progress_report_four($progress_report);			} else if ($this->input->post('report_no') == "5") {				$result = $this->Research_model->upload_progress_report_five($progress_report);			} else if ($this->input->post('report_no') == "6") {				$result = $this->Research_model->upload_progress_report_six($progress_report);			}			$this->session->set_flashdata('success', 'Report uploaded successfully!');			redirect($_SERVER['HTTP_REFERER']);		}		$data['progress_report'] = $this->Research_model->get_single_progress_report();		$this->load->view('admin/add_progress_report', $data);	}}