<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed'); class News_controller extends CI_Controller { 	public function __construct(){		parent::__construct();		$this->is_logged();		$this->check_access();	}	public function is_logged(){		if($this->session->userdata('admin_id') == ""){			redirect('erp-access');		}	}	public function check_access(){		if($this->session->userdata('admin_id') != "1"){			$access = $this->Setting_model->get_user_privilege_link();			if(!in_array($this->uri->segment(1),$access)){				$this->session->set_flashdata('message','Sorry! You dont have access to this module!');				redirect(base_url());			}		}	}	public function marquee_news(){		$this->form_validation->set_rules('news','news','required');		if($this->form_validation->run() === FALSE){			$data['single'] = $this->News_model->get_single_marquee_news();			$this->load->view('admin/marquee_news',$data);		}else{			$photo ='';			if($_FILES['photo']['name'] !=""){				$photo = $this->Digitalocean_model->upload_photo($filename="photo",$path="uploads/news/");				/*$tmp = explode('.', $_FILES['photo']['name']);				$ext = end($tmp);				$config = array(					'upload_path' 	=> "uploads/news",					'allowed_types' => "jpg|jpeg|png|pdf",					'encrypt_name'	=> TRUE,				);							$this->upload->initialize($config);				if($this->upload->do_upload('photo')){					$data = $this->upload->data();									$photo = $data['file_name'];					}else{ 					$error = array('error' => $this->upload->display_errors());						$this->upload->display_errors();				}*/			}			$result = $this->News_model->set_marquee_news($photo);			if($result == "0"){				$this->session->set_flashdata('success','News added successfully');			}else{				$this->session->set_flashdata('success','News updated successfully');			}			redirect('marquee_news');		}	}	public function manage_news(){		$this->form_validation->set_rules('heading','heading','required');		if($this->form_validation->run() === FALSE){			$data['single'] = $this->News_model->get_single_manage_news();			// echo "<pre>";print_r($data['single']);exit;			$this->load->view('admin/manage_news',$data);		}else{			$photo ='';			if($_FILES['photo']['name'] !=""){				$photo = $this->Digitalocean_model->upload_photo($filename="photo",$path="uploads/news/");				/*$tmp = explode('.', $_FILES['photo']['name']);				$ext = end($tmp);				$config = array(					'upload_path' 	=> "uploads/news",					'allowed_types' => "jpg|jpeg|png|pdf",					'encrypt_name'	=> TRUE,				);							$this->upload->initialize($config);				if($this->upload->do_upload('photo')){					$data = $this->upload->data();									$photo = $data['file_name'];					}else{ 					$error = array('error' => $this->upload->display_errors());						$this->upload->display_errors();				}*/			}			$result = $this->News_model->set_news($photo);			if($result == "0"){				$this->session->set_flashdata('success','News added successfully');			}else{				$this->session->set_flashdata('success','News updated successfully');			}			redirect('manage_news');		}	}	public function manage_blogs(){		$this->form_validation->set_rules('heading','heading','required');		if($this->form_validation->run() === FALSE){			$data['single'] = $this->News_model->get_single_manage_blogs();			$this->load->view('admin/manage_blogs',$data);		}else{			$photo ='';			if($_FILES['photo']['name'] !=""){				$photo = $this->Digitalocean_model->upload_photo($filename="photo",$path="blog/");				/*$tmp = explode('.', $_FILES['photo']['name']);				$ext = end($tmp);				$config = array(					'upload_path' 	=> "uploads/news",					'allowed_types' => "jpg|jpeg|png|pdf",					'encrypt_name'	=> TRUE,				);							$this->upload->initialize($config);				if($this->upload->do_upload('photo')){					$data = $this->upload->data();									$photo = $data['file_name'];					}else{ 					$error = array('error' => $this->upload->display_errors());						$this->upload->display_errors();				}*/			}			$result = $this->News_model->set_blogs($photo);			if($result == "0"){				$this->session->set_flashdata('success','News added successfully');			}else{				$this->session->set_flashdata('success','News updated successfully');			}			redirect('manage_blogs');		}	}	public function manage_conference(){		$this->form_validation->set_rules('heading','heading','required');		if($this->form_validation->run() === FALSE){			$data['single'] = $this->News_model->get_single_conference();			$this->load->view('admin/manage_conference',$data);		}else{			$photo ='';			if($_FILES['photo']['name'] !=""){				$photo = $this->Digitalocean_model->upload_photo($filename="photo",$path="uploads/news/");				/*$tmp = explode('.', $_FILES['photo']['name']);				$ext = end($tmp);				$config = array(					'upload_path' 	=> "uploads/news",					'allowed_types' => "jpg|jpeg|png|pdf",					'encrypt_name'	=> TRUE,				);							$this->upload->initialize($config);				if($this->upload->do_upload('photo')){					$data = $this->upload->data();									$photo = $data['file_name'];					}else{ 					$error = array('error' => $this->upload->display_errors());						$this->upload->display_errors();				}*/			}			$result = $this->News_model->set_conference($photo);			if($result == "0"){				$this->session->set_flashdata('success','Conference added successfully');			}else{				$this->session->set_flashdata('success','Conference updated successfully');			}			redirect('manage_conference');		}	}	public function university_activity(){		if($this->input->post('video_submit') == 'submit_video' ){			$photo ='';			if($_FILES['video']['name'] !=""){				$photo = $this->Digitalocean_model->upload_photo($filename="video",$path="images/university_activity/video/");				/*$tmp = explode('.', $_FILES['video']['name']);				$ext = end($tmp);				$config = array(					'upload_path' 	=> "images/university_activity/video",					'allowed_types' => "*",					'encrypt_name'	=> TRUE,				);							$this->upload->initialize($config);				if($this->upload->do_upload('video')){					$data = $this->upload->data();									$photo = $data['file_name'];					}else{ 					$error = array('error' => $this->upload->display_errors());						$this->upload->display_errors();				}*/			}			$result = $this->News_model->set_video($photo);			if($result == "0"){				$this->session->set_flashdata('success','Activity Video added successfully');			}else{				$this->session->set_flashdata('success','Activity video updated successfully');			}			redirect('university_activity');		} 			$this->form_validation->set_rules('title','Title','required');		if($this->form_validation->run() === FALSE){			if($this->uri->segment(3) == "video"){				$data['video'] = $this->News_model->get_single_activity_video();			}else{				$data['single'] = array(); 			}			$data['single'] = $this->News_model->get_single_activity_image();			$this->load->view('admin/university_activity',$data);		}else{			$photo ='';			if($_FILES['photo']['name'] !=""){				$photo = $this->Digitalocean_model->upload_photo($filename="photo",$path="images/university_activity/images/");				/*$tmp = explode('.', $_FILES['photo']['name']);				$ext = end($tmp);				$config = array(					'upload_path' 	=> "images/university_activity/images",					'allowed_types' => "jpg|jpeg|png|pdf",					'encrypt_name'	=> TRUE,				);							$this->upload->initialize($config);				if($this->upload->do_upload('photo')){					$data = $this->upload->data();									$photo = $data['file_name'];					}else{ 					$error = array('error' => $this->upload->display_errors());						$this->upload->display_errors();				}*/			}			$result = $this->News_model->set_image($photo);			if($result == "0"){				$this->session->set_flashdata('success','Activity Image  added successfully');			}else{				$this->session->set_flashdata('success','Activity Image updated successfully');			}			redirect('university_activity');		}	}	}