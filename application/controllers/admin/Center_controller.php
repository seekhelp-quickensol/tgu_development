<?php if (! defined('BASEPATH')) exit('No direct script access allowed');class Center_controller extends CI_Controller{	public function __construct()	{		parent::__construct();		$this->is_logged();		$this->check_access();	}	public function is_logged()	{		if ($this->session->userdata('admin_id') == "") {			redirect('erp-access');		}	}	public function check_access()	{		if ($this->session->userdata('admin_id') != "1") {			$access = $this->Setting_model->get_user_privilege_link();			if (!in_array($this->uri->segment(1), $access)) {				$this->session->set_flashdata('message', 'Sorry! You dont have access to this module!');				redirect(base_url());			}		}	}	/*public function manage_center(){		$this->form_validation->set_rules('center_name','center name','required');		if($this->form_validation->run() === FALSE){			$data['single'] = $this->Center_model->get_single_center();			$data['country'] = $this->Admin_model->get_all_country();			$this->load->view('admin/add_center',$data);		}else{			$photo ='';			if($_FILES['photo']['name'] !=""){				$tmp = explode('.', $_FILES['photo']['name']);				$ext = end($tmp);				$config = array(					'upload_path' 	=> "images/center/photo",					'allowed_types' => "jpg|jpeg|png",					'encrypt_name'	=> TRUE,				);							$this->upload->initialize($config);				if($this->upload->do_upload('photo')){					$data = $this->upload->data();									$photo = $data['file_name'];					}else{ 					$error = array('error' => $this->upload->display_errors());						$this->upload->display_errors();				}			}			$mou ='';			if($_FILES['mou']['name'] !=""){				$tmp = explode('.', $_FILES['mou']['name']);				$ext = end($tmp);				$config = array(					'upload_path' 	=> "images/center/mou",					'allowed_types' => "pdf|jpg|jpeg|png",					'encrypt_name'	=> TRUE,				);							$this->upload->initialize($config);				if($this->upload->do_upload('mou')){					$data = $this->upload->data();									$mou = $data['file_name'];					}else{ 					$error = array('error' => $this->upload->display_errors());						$this->upload->display_errors();				}			}			$adharcard ='';			if($_FILES['adhar_card']['name'] !=""){				$tmp = explode('.', $_FILES['adhar_card']['name']);				$ext = end($tmp);				$config = array(					'upload_path' 	=> "images/center/adharcard",					'allowed_types' => "pdf|jpg|jpeg|png",					'encrypt_name'	=> TRUE,				);							$this->upload->initialize($config);				if($this->upload->do_upload('adhar_card')){					$data = $this->upload->data();									$adharcard = $data['file_name'];					}else{ 					$error = array('error' => $this->upload->display_errors());						$this->upload->display_errors();				}			}			$pan_card ='';			if($_FILES['pan_card']['name'] !=""){				$tmp = explode('.', $_FILES['pan_card']['name']);				$ext = end($tmp);				$config = array(					'upload_path' 	=> "images/center/pan_card",					'allowed_types' => "pdf|jpg|jpeg|png",					'encrypt_name'	=> TRUE,				);							$this->upload->initialize($config);				if($this->upload->do_upload('pan_card')){					$data = $this->upload->data();									$pan_card = $data['file_name'];					}else{ 					$error = array('error' => $this->upload->display_errors());						$this->upload->display_errors();				}			}			$result = $this->Center_model->set_center($photo,$adharcard,$mou,$pan_card);			if($result == "0"){				$this->session->set_flashdata('success','Center added successfully');			}else{				$this->session->set_flashdata('success','Center updated successfully');			}			redirect('manage_center');		}	}*/	public function view_documents()	{		$data['documents'] = $this->Center_model->get_all_documents();		$this->load->view('admin/view_documents', $data);	}	public function view_enquiry_documents()	{		$data['documents'] = $this->Center_model->get_all_enquiry_documents();		$this->load->view('admin/view_documents', $data);	}	public function manage_center()	{	    if($this->input->post('submit_documents') != ""){			$this->Common_model->upload_center_document($this->uri->segment(2));			$this->session->set_flashdata('success', 'Document uploaded successfully');			redirect($_SERVER['HTTP_REFERER']);		}else{    		$this->form_validation->set_rules('center_name', 'center name', 'required');    		if ($this->form_validation->run() === FALSE) {    			$data['single'] = $this->Center_model->get_single_center();    			$data['center'] = $this->Center_model->get_single_center_mous();    			$data['country'] = $this->Admin_model->get_all_country();    			$this->load->view('admin/add_center', $data);    		} else {    			$photo = '';    			if ($_FILES['photo']['name'] != "") {    				$photo = $this->Digitalocean_model->upload_photo($filename = "photo", $path = "images/center/photo/");    			}    			$adharcard = '';    			if (isset(($_FILES['identity_file']['name'])) &&  $_FILES['identity_file']['name'] != "") {    				$adharcard = $this->Digitalocean_model->upload_photo($filename = "identity_file", $path = "images/center/adharcard/");    			}    			    			$mou ='';				if($_FILES['mou']['name'] !=""){					$mou = $this->Digitalocean_model->upload_photo($filename="mou",$path="images/center/mou/"); 				}							$pan_card ='';				if($_FILES['pan_card']['name'] !=""){					$pan_card = $this->Digitalocean_model->upload_photo($filename="pan_card",$path="images/center/pan_card/"); 				}				$passport ='';				if($_FILES['passport']['name'] !=""){					$passport = $this->Digitalocean_model->upload_photo($filename="passport",$path="images/center/passport/"); 				}    			    			$result = $this->Center_model->set_center($photo,$adharcard,$mou,$pan_card,$passport);    			if ($result == "0") {    				$this->session->set_flashdata('success', 'Center added successfully');    			} else {    				$this->session->set_flashdata('success', 'Center updated successfully');    			}    			redirect($_SERVER['HTTP_REFERER']);    		}		}	}	/* old_pattern	public function assign_course(){ 		$this->form_validation->set_rules('id','center name','required'); 		if($this->form_validation->run() === FALSE){ 			$data['course'] = $this->Center_model->get_active_course(); 			$data['single'] = $this->Center_model->get_single_center(); 			$this->load->view('admin/assign_course',$data); 		}else{ 			$this->Center_model->update_center_course(); 			$this->session->set_flashdata('success','Course updated successfully'); 			redirect($_SERVER['HTTP_REFERER']);		}	}*/	public function assign_course(){		$this->form_validation->set_rules('id', 'center name', 'required');		if ($this->form_validation->run() === FALSE) {			$data['course'] = $this->Center_model->get_active_course();// 			echo "<pre>";// 			print_r($data['course']);exit;			$data['single'] = $this->Center_model->get_single_center();			$data['session'] = $this->Center_model->get_all_session_course();			$this->load->view('admin/assign_course', $data);		} else {			$this->Center_model->update_center_course();			$this->session->set_flashdata('success', 'Course updated successfully');			redirect($_SERVER['HTTP_REFERER']);		}	}	public function assign_course_pulp()	{		$this->form_validation->set_rules('id', 'center name', 'required');		if ($this->form_validation->run() === FALSE) {			$data['course'] = $this->Center_model->get_active_course_pulp();			$data['single'] = $this->Center_model->get_single_center();			$this->load->view('admin/assign_course', $data);		} else {			$this->Center_model->update_center_course();			$this->session->set_flashdata('success', 'Course updated successfully');			redirect($_SERVER['HTTP_REFERER']);		}	}	public function list_manage_center()	{		$this->load->view('admin/center_list');	}	public function pending_center()	{		$this->load->view('admin/new_center_list');	}	public function hold_center()	{		$this->load->view('admin/hold_center');	}	public function deactive_center()	{		$this->load->view('admin/deactive_center');	}	public function center_mou()	{		$this->form_validation->set_rules('id', 'center name', 'required');		if ($this->form_validation->run() === FALSE) {			$data['center'] = $this->Center_model->get_single_center();			$this->load->view('admin/add_center_mou', $data);		} else {			$mou = '';			if ($_FILES['mou']['name'] != "") {				$mou = $this->Digitalocean_model->upload_photo($filename = "mou", $path = "images/center/mou/");				/*$tmp = explode('.', $_FILES['mou']['name']);				$ext = end($tmp);				$config = array(					'upload_path' 	=> "images/center/mou",					'allowed_types' => "pdf|jpg|jpeg|png",					'encrypt_name'	=> TRUE,				);							$this->upload->initialize($config);				if($this->upload->do_upload('mou')){					$data = $this->upload->data();									$mou = $data['file_name'];					}else{ 					$error = array('error' => $this->upload->display_errors());						$this->upload->display_errors();				}*/			}			$result = $this->Center_model->set_center_mou($mou);			$this->session->set_flashdata('success', 'MOU added successfully');			redirect($_SERVER['HTTP_REFERER']);		}	}	public function center_finance()	{		$this->form_validation->set_rules('center_id', 'center name', 'required');		if ($this->form_validation->run() === FALSE) {			$data['center'] = $this->Center_model->get_single_center();			$data['single'] = $this->Center_model->get_single_center_payment();			$this->load->view('admin/center_finance', $data);		} else {			$result = $this->Center_model->set_center_finance();			if ($result == "1") {				$this->session->set_flashdata('success', 'Payment added successfully');			} else {				$this->session->set_flashdata('success', 'Payment updated successfully');			}			redirect('center_finance/' . $this->input->post('center_id'));		}	}	public function pending_center_subject()	{		$this->load->view('admin/pending_center_subject');	}	public function center_reset_password()	{		$this->form_validation->set_rules('center_id', 'center name', 'required');		if ($this->form_validation->run() === FALSE) {			$data['center'] = $this->Center_model->get_single_center();			$this->load->view('admin/center_reset_password', $data);		} else {			$result = $this->Center_model->set_reset_center_password();			$this->session->set_flashdata('success', 'Password updated successfully!');			redirect('list_manage_center');		}	}	public function manage_center_enquiry()	{		$this->load->view('admin/center_enquiry');	}	public function center_send_login()	{		$this->Center_model->center_send_login();		$this->session->set_flashdata('success', 'Login details send successfully!');		redirect('list_manage_center');	}	public function manage_center_course()	{		$this->form_validation->set_rules('course', 'course', 'required');		if ($this->form_validation->run() === FALSE) {			$data['course'] = $this->Center_model->get_active_course();			$data['center'] = $this->Center_model->get_active_center();			$data['single'] = $this->Center_model->get_single_course_share();			$this->load->view('admin/manage_center_course', $data);		} else {			$result = $this->Center_model->set_center_subject_share();			if ($result == 0) {				$this->session->set_flashdata('success', 'Record added successfully!');			} else {				$this->session->set_flashdata('success', 'Record updated successfully!');			}			redirect('manage_center_course');		}	}	public function copy_center_fees()	{		$this->form_validation->set_rules('from_center', 'from center', 'required');		if ($this->form_validation->run() === FALSE) {			$data['center'] = $this->Center_model->get_active_center();			$this->load->view('admin/copy_center_fees', $data);		} else {			$result = $this->Center_model->set_center_course_fees();		}	}	public function add_center_login()	{		$this->form_validation->set_rules('center', 'Please select center', 'required');		if ($this->form_validation->run() === FALSE) {			$data['single'] = $this->Center_model->get_single_center_login();			$data['active_centers'] = $this->Center_model->get_active_centers();			$data['centers_login'] = $this->Center_model->get_all_centers_login();			$this->load->view('admin/add_center_login', $data);		} else {			$result = $this->Center_model->set_center_login();			if ($result == 0) {				$this->session->set_flashdata('success', 'Login added successfully!');			} else {				$this->session->set_flashdata('success', 'Login updated successfully!');			}			redirect('add_center_login');		}	}	public function add_center_private_account()	{		if ($this->input->post('delete') == "Delete") {			$this->Center_model->delete_multiple_account_id();			$this->session->set_flashdata('success', 'Records deleted successfully!');			redirect($_SERVER['HTTP_REFERER']);		}		if ($this->input->post('upload') == "upload") {			$data = array();			$this->load->library('excel');			if (isset($_FILES["userfile"]["name"])) {				$path = $_FILES["userfile"]["tmp_name"];				$object = PHPExcel_IOFactory::load($path);				ini_set('memory_limit', '-1');				foreach ($object->getWorksheetIterator() as $worksheet) {					$highestRow = $worksheet->getHighestRow();					$highestColumn = $worksheet->getHighestColumn();					$current_adding_mark = 0;					for ($row = 2; $row <= $highestRow; $row++) {						if ($worksheet->getCellByColumnAndRow(1, $row)->getValue() != '') {							if ($worksheet->getCellByColumnAndRow(1, $row)->getValue() == "" || $worksheet->getCellByColumnAndRow(2, $row)->getValue() == "" || $worksheet->getCellByColumnAndRow(3, $row)->getValue() == "" || $worksheet->getCellByColumnAndRow(4, $row)->getValue() == "" || $worksheet->getCellByColumnAndRow(5, $row)->getValue() == "" || $worksheet->getCellByColumnAndRow(6, $row)->getValue() == "" || $worksheet->getCellByColumnAndRow(7, $row)->getValue() == "" || $worksheet->getCellByColumnAndRow(8, $row)->getValue() == "" || $worksheet->getCellByColumnAndRow(9, $row)->getValue() == "") {								$this->session->set_flashdata('message', 'Please fill the all fields');								redirect($_SERVER['HTTP_REFERER']);							}							$enrollment_number 			    = $worksheet->getCellByColumnAndRow(1, $row)->getValue();							$student_name               			= $worksheet->getCellByColumnAndRow(2, $row)->getValue();							$course               			= $worksheet->getCellByColumnAndRow(3, $row)->getValue();							$stream 			    	= $worksheet->getCellByColumnAndRow(4, $row)->getValue();							$session		 	    = $worksheet->getCellByColumnAndRow(5, $row)->getValue();							$total_amount		 	    = $worksheet->getCellByColumnAndRow(6, $row)->getValue();							$amount		 	    = $worksheet->getCellByColumnAndRow(7, $row)->getValue();							$installment		 	    = $worksheet->getCellByColumnAndRow(8, $row)->getValue();							$reference_number		 	    = $worksheet->getCellByColumnAndRow(9, $row)->getValue();							$this->db->where('enrollment_number', $enrollment_number);							$student = $this->db->get('tbl_student');							$student = $student->row();							if (!empty($student)) {								$student_name = $student->student_name;							}							$data[] = array(								'center_id' 			=> $this->input->post('center_id'),								'enrollment_number' 	=> str_replace("‌", "", $enrollment_number),								'student_name' 			=> str_replace("‌", "", $student_name),								'session'				=> str_replace("‌", "", $session),								'total_amount'			=> str_replace("‌", "", $total_amount),								'amount'				=> str_replace("‌", "", $amount),								'installment'			=> str_replace("‌", "", $installment),								'reference_number'		=> str_replace("‌", "", $reference_number),								'date'					=> date("Y-m-d"),								'created_on'			=> date("Y-m-d H:i:s"),							);						}					}				}				$this->Center_model->set_center_bulk_ledger_account($data);				$this->session->set_flashdata('success', 'data imported successfully!');				redirect($_SERVER['HTTP_REFERER']);			} else {				$this->session->set_flashdata('message', 'data not imported successfully!');				redirect($_SERVER['HTTP_REFERER']);			}		}		if ($this->input->post('bank_submit') == "bank_submit") {			$this->Center_model->set_private_received_account();			redirect($_SERVER['HTTP_REFERER']);		}		$this->form_validation->set_rules('center', 'center', 'required');		if ($this->form_validation->run() === FALSE) {			$data['active_centers'] = $this->Center_model->get_active_centers();			$data['ledger'] = $this->Center_model->get_center_ledger();			$data['center_students_all'] = $this->Center_model->get_student_ledger_statement();			$data['received'] = $this->Center_model->get_private_received_account();			$this->load->view('admin/add_center_private_account', $data);		} else {			$result = $this->Center_model->set_center_ledger_account();			if ($result == 0) {				$this->session->set_flashdata('success', 'Details added successfully!');			} else {				$this->session->set_flashdata('success', 'Details updated successfully!');			}			redirect($_SERVER['HTTP_REFERER']);		}	}	public function center_login_list()	{		$data['centers_login'] = $this->Center_model->get_all_centers_login();		$this->load->view('admin/center_login_list', $data);	}	public function add_cluster_center()	{		$this->form_validation->set_rules('name', 'Please enter cluster center name', 'required');		if ($this->form_validation->run() === FALSE) {			$data['active_centers'] = $this->Center_model->get_active_centers();			$data['single'] = $this->Center_model->get_single_cluster_center();			// print_r($data['centers']);exit();			$this->load->view('admin/add_cluster_center', $data);		} else {			$result = $this->Center_model->set_cluster_center();			if ($result == 0) {				$this->session->set_flashdata('success', 'Cluster Center added successfully!');			} else {				$this->session->set_flashdata('success', 'Cluster Center updated successfully!');			}			redirect('cluster_center_list');		}	}	public function cluster_center_list()	{		$data['cluster_center'] = $this->Center_model->get_all_cluster_center();		$this->load->view('admin/cluster_center_list', $data);	}	public function information_center_success_list()	{		$this->load->view('admin/information_center_success_list');	}	public function information_center_failed_list()	{		$this->load->view('admin/information_center_failed_list');	}	public function update_information_center_payment()	{		$this->form_validation->set_rules('amount', 'amount', 'required');		if ($this->form_validation->run() === FALSE) {			$data['single'] = $this->Center_model->get_single_information_center_data();			$this->load->view('admin/update_information_center_payment', $data);		} else {			$this->Center_model->set_update_information_payment();			$this->session->set_flashdata('success', 'Pyament details updated successfully!');			redirect('information_center_success_list');		}	}	public function information_center_list()	{		$this->load->view('admin/information_center_list');	}	public function center_wallet_payment_details()	{		$this->load->view('admin/center_wallet_payment_details');	}	public function update_wallet_details()	{		$this->form_validation->set_rules('id', 'center', 'required');		if ($this->form_validation->run() === FALSE) {			$data['single'] = $this->Center_model->get_single_wallet_data();			$this->load->view('admin/update_wallet_details', $data);		} else {			$this->Center_model->set_update_wallet();			$this->session->set_flashdata('success', 'wallet updaated successfully!');			redirect('center_wallet_payment_details');		}	}	public function add_center_wallet_payment_details()	{		$this->form_validation->set_rules('transaction_id', 'Transaction Number', 'required');		if ($this->form_validation->run() === FALSE) {			$data["centers"] = $this->Center_model->get_center_data_for_dropdown();			$this->load->view('admin/add_center_wallet_payment_details', $data);		} else {			$this->Center_model->set_wallet_payment();			$this->session->set_flashdata('success', 'Pyament details updated successfully!');			redirect('center_wallet_payment_details');		}	}}